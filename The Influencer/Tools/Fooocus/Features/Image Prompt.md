Fooocus 2.1.0 has completed the implementation of image prompts. Because after this version, almost all features of Midjourney are included, the version directly jump to 2.1.0.

Image Prompt is one of the most important feature of Midjourney. Below is the banner from Midjourney:

[![image](https://private-user-images.githubusercontent.com/19834515/273424047-85642534-af32-4f99-a0cb-6a0e42469ad9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjQwNDctODU2NDI1MzQtYWYzMi00Zjk5LWEwY2ItNmEwZTQyNDY5YWQ5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWU0YzRhNTc0M2JmNjYzMDFhZjU3ZWMyNzM5ZTg0YTNjYTNiYTk3YjQ4Yjc5M2ZlYWUzNDU5MTBhMWM3ZGJkZmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.OX5tqW-prqY9sF_QGXjwFJMXcLgTT6BTXShbPWB5uZc)](https://private-user-images.githubusercontent.com/19834515/273424047-85642534-af32-4f99-a0cb-6a0e42469ad9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjQwNDctODU2NDI1MzQtYWYzMi00Zjk5LWEwY2ItNmEwZTQyNDY5YWQ5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWU0YzRhNTc0M2JmNjYzMDFhZjU3ZWMyNzM5ZTg0YTNjYTNiYTk3YjQ4Yjc5M2ZlYWUzNDU5MTBhMWM3ZGJkZmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.OX5tqW-prqY9sF_QGXjwFJMXcLgTT6BTXShbPWB5uZc)

In Fooocus, it looks like this:

[![image](https://private-user-images.githubusercontent.com/19834515/273424222-ccb279ff-4cc0-40f0-a3e0-cdec2f99fc25.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjQyMjItY2NiMjc5ZmYtNGNjMC00MGYwLWEzZTAtY2RlYzJmOTlmYzI1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTkzM2EzMmZjMDgyNDM1ZjdkMzUyZGQyYjBiNzU4ZjEyZmE1Nzc3YmFiNmQ3NGEyY2E2ZTMxMzIzNjBjODJkZjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.I2LNBw3009Iji2SauYwl0Fvj3x2GHRD7p01WaIIMkLM)](https://private-user-images.githubusercontent.com/19834515/273424222-ccb279ff-4cc0-40f0-a3e0-cdec2f99fc25.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjQyMjItY2NiMjc5ZmYtNGNjMC00MGYwLWEzZTAtY2RlYzJmOTlmYzI1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTkzM2EzMmZjMDgyNDM1ZjdkMzUyZGQyYjBiNzU4ZjEyZmE1Nzc3YmFiNmQ3NGEyY2E2ZTMxMzIzNjBjODJkZjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.I2LNBw3009Iji2SauYwl0Fvj3x2GHRD7p01WaIIMkLM)

Technically, this feature is based on a mixture of IP-Adapter, and a pre-computed negative embedding from Fooocus team, an attention hacking algorithm from Fooocus team, and an adaptive balancing/weighting algorithm from Fooocus team.

The motivation of these efforts is to achieve a best match to the Midjourney Image Prompt. In other software like A1111/ComfyUI/InvokeAI, the IP-Adapter still has some open problems like ignoring text prompts, or over-burned results when multiple images are used. These problems are solved in Fooocus and users can enjoy Midjourney-like experience of Image Prompt.

The detailed differences are in the below table:

||Midjourney Image Pompt|IP-Adapter + A1111/ComfyUI/InvokeAI|Fooocus Image Prompt|
|---|---|---|---|
|Work together with text prompts|Text prompts and image prompts will be mixed|Tends to ignore text prompts|Text prompts and image prompts will be mixed|
|Multiple images as input|Result quality does not decrease for multiple image inputs|Using more images leads to worse result quality|Result quality does not decrease for multiple image inputs|
|When the method fails (single image inputs)|Give unrelated but still high-quality image|Give related but low-quality and over-burned image|Give unrelated but still high-quality image|
|When the method fails (multiple image inputs)|Partially ignore some images that it cannot understand, still give high-quality results|Give related but low-quality and over-burned image|Partially ignore some images that it cannot understand, still give high-quality results|
|Quality Influence|Using image prompt does not influence the output quality|Using image prompt influences the quality of base model|Using image prompt does not influence the output quality, almostly|
|Result diversity|Results are still diverse after using image prompts|Results tend to have small and minimized variations|Results are still diverse after using image prompts|

**Using this method will download 2.5GB files at the first time!**

# Example: Single Image Prompt without Text Prompts

(Non-cherrypicked random batch, default parameters, real results should be better if tuned)

[![image](https://private-user-images.githubusercontent.com/19834515/273445930-2ac3cffc-5ab6-408a-94c6-904e54684d51.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0NDU5MzAtMmFjM2NmZmMtNWFiNi00MDhhLTk0YzYtOTA0ZTU0Njg0ZDUxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUyMWI5NGZiN2Y4NjYyZWZmYmEwN2RlMGY1N2IxNTBmMTI3OTlmYjg2M2VjNTQwYzc2MzI5ODU2YzU0NTNmMDAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.eNsU9ZPrZ-Fen9scfMf1fUgXGA-YSc7BBCpFr3DpRRA)](https://private-user-images.githubusercontent.com/19834515/273445930-2ac3cffc-5ab6-408a-94c6-904e54684d51.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0NDU5MzAtMmFjM2NmZmMtNWFiNi00MDhhLTk0YzYtOTA0ZTU0Njg0ZDUxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUyMWI5NGZiN2Y4NjYyZWZmYmEwN2RlMGY1N2IxNTBmMTI3OTlmYjg2M2VjNTQwYzc2MzI5ODU2YzU0NTNmMDAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.eNsU9ZPrZ-Fen9scfMf1fUgXGA-YSc7BBCpFr3DpRRA)

(seed 1234, [here is the image](https://github.com/lllyasviel/Fooocus/assets/19834515/3a8aaf95-d37e-440a-83eb-e8d80fb066bb))

(this example uses default style and Fooocus V2 style)

# Example: Single Image Prompt with Text Prompts

Note that mixing text and IP-Adapter is extremely difficult in ComfyUI/A1111. Fooocus does not have this problem.

(Non-cherrypicked random batch, default parameters, real results should be better if tuned)

[![image](https://private-user-images.githubusercontent.com/19834515/273426110-981c8bc3-35c9-4ece-9945-dbc92a1a57d8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjYxMTAtOTgxYzhiYzMtMzVjOS00ZWNlLTk5NDUtZGJjOTJhMWE1N2Q4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTllYTc4NzFlZDdiNjMwYTFjZGI3YTUxYjQ0MDk4MjlhNzNiZTEyYjYwOWZkYTljN2I3ZTdkYjYxODM2ZWRkYmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Zsg74d3sfWgCm7PxStUqPcuNkxqQD0pgWxl5mgSEIQA)](https://private-user-images.githubusercontent.com/19834515/273426110-981c8bc3-35c9-4ece-9945-dbc92a1a57d8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjYxMTAtOTgxYzhiYzMtMzVjOS00ZWNlLTk5NDUtZGJjOTJhMWE1N2Q4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTllYTc4NzFlZDdiNjMwYTFjZGI3YTUxYjQ0MDk4MjlhNzNiZTEyYjYwOWZkYTljN2I3ZTdkYjYxODM2ZWRkYmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Zsg74d3sfWgCm7PxStUqPcuNkxqQD0pgWxl5mgSEIQA)

(this example uses default style and Fooocus V2 style)

# Example: Multiple Images without Text Prompts

Note that mixing multiple IP-Adapters is likely to cause lower result quality in ComfyUI/A1111. Using Fooocus can resolve this to some extents.

(Non-cherrypicked random batch, default parameters, real results should be better if tuned)

[![image](https://private-user-images.githubusercontent.com/19834515/273426511-9d89132e-593f-4a85-a9a3-6b61af81a35a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY1MTEtOWQ4OTEzMmUtNTkzZi00YTg1LWE5YTMtNmI2MWFmODFhMzVhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTY1MDI2NjI5NmE2NDNkODRiZjllYzUzOTNhMGJlMGU3NTE2YmY0YjY4NjQyZTZiOWJhNzU2ZTAxMzYxYTg0NzUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Yb5oMqqQvn-tTwuSfAc6DhHQJ1Gihj9c-__IiSFFQsA)](https://private-user-images.githubusercontent.com/19834515/273426511-9d89132e-593f-4a85-a9a3-6b61af81a35a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY1MTEtOWQ4OTEzMmUtNTkzZi00YTg1LWE5YTMtNmI2MWFmODFhMzVhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTY1MDI2NjI5NmE2NDNkODRiZjllYzUzOTNhMGJlMGU3NTE2YmY0YjY4NjQyZTZiOWJhNzU2ZTAxMzYxYTg0NzUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Yb5oMqqQvn-tTwuSfAc6DhHQJ1Gihj9c-__IiSFFQsA)

(this example uses default style and Fooocus V2 style)

# Example: Multiple Images with Text Prompts and Even Multiple Styles

This is almost impossible in A1111/ComfyUI since mixing text and IP-Adapter is extremely difficult in ComfyUI/A1111, and mixing multiple IP-Adapters is likely to cause lower result quality in ComfyUI/A1111.

(Non-cherrypicked random batch, default parameters, real results should be better if tuned)

[![image](https://private-user-images.githubusercontent.com/19834515/273427368-c9055b0d-123f-42d4-86c5-42e82e76045e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjczNjgtYzkwNTViMGQtMTIzZi00MmQ0LTg2YzUtNDJlODJlNzYwNDVlLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTY0MGRkMDRiNGU5ZDEyMTNlYTZlMGI0MTQzODI1MjAzOWI3OGRkODE1Y2NiMDQwM2U4MTIwMGI3OTNmYzU4ZjAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.nvY241p4v9ffd0biwR_-U7zqlmFduI8d-M-EI5S9x28)](https://private-user-images.githubusercontent.com/19834515/273427368-c9055b0d-123f-42d4-86c5-42e82e76045e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjczNjgtYzkwNTViMGQtMTIzZi00MmQ0LTg2YzUtNDJlODJlNzYwNDVlLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTY0MGRkMDRiNGU5ZDEyMTNlYTZlMGI0MTQzODI1MjAzOWI3OGRkODE1Y2NiMDQwM2U4MTIwMGI3OTNmYzU4ZjAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.nvY241p4v9ffd0biwR_-U7zqlmFduI8d-M-EI5S9x28)

[![image](https://private-user-images.githubusercontent.com/19834515/273426755-38409554-7bf1-4168-85a1-44f75f443183.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY3NTUtMzg0MDk1NTQtN2JmMS00MTY4LTg1YTEtNDRmNzVmNDQzMTgzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVmYjEyNGNiY2E2N2I3YmU0NjViZTZmMzc1OTg1MjQ0OWY0OGJjYmI4YWEyYmQ1NTkyYjk1Y2M0NTZlYTZhNjImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.hH334ZEJXp2le-6N4FXyRkCnxYOhui3xQytnvTePHFI)](https://private-user-images.githubusercontent.com/19834515/273426755-38409554-7bf1-4168-85a1-44f75f443183.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY3NTUtMzg0MDk1NTQtN2JmMS00MTY4LTg1YTEtNDRmNzVmNDQzMTgzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVmYjEyNGNiY2E2N2I3YmU0NjViZTZmMzc1OTg1MjQ0OWY0OGJjYmI4YWEyYmQ1NTkyYjk1Y2M0NTZlYTZhNjImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.hH334ZEJXp2le-6N4FXyRkCnxYOhui3xQytnvTePHFI)

This image is too complicated to understand so I annotated here:

[![image](https://private-user-images.githubusercontent.com/19834515/273426855-bf1bed11-edd4-4656-bb57-86bd833112dc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY4NTUtYmYxYmVkMTEtZWRkNC00NjU2LWJiNTctODZiZDgzMzExMmRjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlNTYyM2MwYTA4M2Q2Yjk0OTdmZWU3MjA2OWZkYjc3MzE1ODg5ZDc0Y2IzMDY5NGIzMTA5Y2QzOWZjYTk3Y2EmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.-GZNmbEFGhbm7uGs-gyx685yFkoK-62buSz0l9lJmQA)](https://private-user-images.githubusercontent.com/19834515/273426855-bf1bed11-edd4-4656-bb57-86bd833112dc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0MjY4NTUtYmYxYmVkMTEtZWRkNC00NjU2LWJiNTctODZiZDgzMzExMmRjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlNTYyM2MwYTA4M2Q2Yjk0OTdmZWU3MjA2OWZkYjc3MzE1ODg5ZDc0Y2IzMDY5NGIzMTA5Y2QzOWZjYTk3Y2EmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.-GZNmbEFGhbm7uGs-gyx685yFkoK-62buSz0l9lJmQA)

So mixing too many things make it hard to recognize but everything is there and it does not fail or causing quality decerase, unlike ComfyUI/A1111/InvokeAI.

# Fooocus Image Prompt (Advanced)

If you check “advanced”, you will be able to use two structure controls:

**PyraCanny**: A pyramid-based Canny edge control. The reason is that SDXL uses 1024px images and standard Canny tends to miss some image details from time to time, at such a high resolution. This method uses multiple resolutions to detect canny edges and then combine them softly, so that more structures are captured (than canny). The pyramid part is from [“Edge Drawing: A combined real-time edge and segment detector”](https://www.sciencedirect.com/science/article/pii/S1047320312000831). You will download 350MB control models when using it.

**CPDS**: A structure extraction algorithm from [“Contrast Preserving Decolorization (CPD)”](http://www.cse.cuhk.edu.hk/leojia/projects/color2gray/index.html). The “CPDS” means CPD Structure. The control model is modified by Fooocus team – it starts from SAI’s depth control-lora. The reason for using this method is for the fast speed and download-free preprocessor. Note that we only use the structure part of images, and it is not really “decolorization”. You will download 350MB control models when using it.

(Non-cherrypicked random batch, default parameters, real results should be better if tuned)

[![image](https://private-user-images.githubusercontent.com/19834515/273427739-fb7ac0fb-3b13-4e81-805d-e21841473852.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0Mjc3MzktZmI3YWMwZmItM2IxMy00ZTgxLTgwNWQtZTIxODQxNDczODUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ1N2IxMTI3M2VlOTdmZmRiZWI2ZjM3YmRkOGY5YmY4ODU3Y2RhZTRiMWI5YzcwMTk0MWU1M2MwM2Q1M2FkZGEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.53zNRaKUCSZJzxElQRIoxHkvIenJ4kthr3MZdd-lDjk)](https://private-user-images.githubusercontent.com/19834515/273427739-fb7ac0fb-3b13-4e81-805d-e21841473852.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0Mjc3MzktZmI3YWMwZmItM2IxMy00ZTgxLTgwNWQtZTIxODQxNDczODUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ1N2IxMTI3M2VlOTdmZmRiZWI2ZjM3YmRkOGY5YmY4ODU3Y2RhZTRiMWI5YzcwMTk0MWU1M2MwM2Q1M2FkZGEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.53zNRaKUCSZJzxElQRIoxHkvIenJ4kthr3MZdd-lDjk)

(this example uses default style and Fooocus V2 style)

[![image](https://private-user-images.githubusercontent.com/19834515/273446475-d0e1470a-c577-4991-bb98-1ff8de637ee8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0NDY0NzUtZDBlMTQ3MGEtYzU3Ny00OTkxLWJiOTgtMWZmOGRlNjM3ZWU4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUxZTI1YWNkNDQ5OTJhZGNiMjVlN2VmZThlYjI4YzhhYTczNWZkODFlM2U0NmVkODk5ZjJhMmI1NzRiNmYyNTMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SN-rqQ10NEHiTNGHvAJTbpwjOW_XqsmcPltgO0QyaBg)](https://private-user-images.githubusercontent.com/19834515/273446475-d0e1470a-c577-4991-bb98-1ff8de637ee8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0NDY0NzUtZDBlMTQ3MGEtYzU3Ny00OTkxLWJiOTgtMWZmOGRlNjM3ZWU4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUxZTI1YWNkNDQ5OTJhZGNiMjVlN2VmZThlYjI4YzhhYTczNWZkODFlM2U0NmVkODk5ZjJhMmI1NzRiNmYyNTMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SN-rqQ10NEHiTNGHvAJTbpwjOW_XqsmcPltgO0QyaBg)

(this example uses default style and Fooocus V2 style)

[![image](https://private-user-images.githubusercontent.com/19834515/273480065-18941915-59ec-48b1-bcf1-051a4a119193.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0ODAwNjUtMTg5NDE5MTUtNTllYy00OGIxLWJjZjEtMDUxYTRhMTE5MTkzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlZWZmYjBmYzc2ZTZjZmIyMjY3Y2ExY2U2ZmEwZDFlM2EzMDgwNjk0NzliNzc4YjE2ZDZlNzJjMGMwZDFjZDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.7g_CKFAHH5oOrOEPc21OiaQFEjFfR38feUREwbxRG9U)](https://private-user-images.githubusercontent.com/19834515/273480065-18941915-59ec-48b1-bcf1-051a4a119193.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjMzMjc4MTQsIm5iZiI6MTcyMzMyNzUxNCwicGF0aCI6Ii8xOTgzNDUxNS8yNzM0ODAwNjUtMTg5NDE5MTUtNTllYy00OGIxLWJjZjEtMDUxYTRhMTE5MTkzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODEwVDIyMDUxNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlZWZmYjBmYzc2ZTZjZmIyMjY3Y2ExY2U2ZmEwZDFlM2EzMDgwNjk0NzliNzc4YjE2ZDZlNzJjMGMwZDFjZDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.7g_CKFAHH5oOrOEPc21OiaQFEjFfR38feUREwbxRG9U)

(this example uses default style and Fooocus V2 style)

### For developers:

In Developer Debug Mode, you can mix the upscale/vary/inpaint with all above features if you know what you are doing and REALLY need it (the denoising strength can also be set in Developer mode). You can also get the preprocessor result by checking the “debug preprocessor”.

But keep in mind:

If you accidentally get satisfying results in Fooocus by tuning a lot of advanced parameters, you should try to copy your positive prompt, reopen Fooocus, do not change anything, and paste the prompt. You will find that results are even better, and all those tunings are unnecessary. (The only exception is probably changing base model in “Advanced”.)